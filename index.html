<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="None">
        
        
        <link rel="shortcut icon" href="img/favicon.ico">
        <title>My Docs</title>
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link href="css/fontawesome.min.css" rel="stylesheet">
        <link href="css/brands.min.css" rel="stylesheet">
        <link href="css/solid.min.css" rel="stylesheet">
        <link href="css/v4-font-face.min.css" rel="stylesheet">
        <link href="css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body class="homepage">
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href=".">My Docs</a>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#practica-32-despliegue-con-node-express-y-con-netlify" class="nav-link">Práctica 3.2 - Despliegue con Node Express y con Netlify</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#despliegue-con-node-express" class="nav-link">Despliegue con Node Express</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#cuestiones-sobre-node-express" class="nav-link">Cuestiones sobre Node Express</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#despliegue-con-netlify" class="nav-link">Despliegue con Netlify</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#despliegue-con-vercel" class="nav-link">Despliegue con Vercel</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="practica-32-despliegue-con-node-express-y-con-netlify">Práctica 3.2 - Despliegue con Node Express y con Netlify</h1>
<h2 id="despliegue-con-node-express">Despliegue con Node Express</h2>
<p>En primer lugar debemos asegurarnos de que Tomcat no está ejecutándose: </p>
<pre><code class="language-console">sudo systemctl status tomcat9   # Comprobar el estado de Tomcat
sudo systemctl stop tomcat9 # Parar Tomcat
</code></pre>
<p>A continuación instalamos Node.js y el gestor de paquetes npm:</p>
<pre><code class="language-console">sudo apt install nodejs npm
</code></pre>
<p>Para realizar el despliegue, clonamos un repositorio de GitHub que contenga 
una aplicación Node. Nos colocamos dentro del directorio del proyecto e 
instalamos los paquetes requeridos ejecutando: </p>
<pre><code class="language-console">npm install
</code></pre>
<p>También es importante comprobar en el código fuente de la aplicación el puerto 
que utilizará para comunicarse. En mi caso es el puerto 3000, por lo que ejecuto: </p>
<pre><code class="language-console">sudo ufw allow 3000/tcp
</code></pre>
<p>Si tratamos de desplegar la aplicación, aparecerá el mensaje de error "nodemon: 
not found". Para solventar este problema, agregamos dicho paquete al archivo 
package.json ejecutando:</p>
<pre><code class="language-console">npm install nodemon --save-dev
</code></pre>
<p>Y ahora podremos desplegar la aplicación correctamente con: </p>
<pre><code class="language-console">npm run start
</code></pre>
<p>Y podremos acceder a ella desde el navegador de nuestra máquina anfitriona indicando 
la IP de nuestra máquina virtual y el puerto en el que se aloja la aplicación (en 
mi caso, el 3000):</p>
<p><img alt="Aplicación Node desplegada" src="images/app_node_desplegada.png" /></p>
<h2 id="cuestiones-sobre-node-express">Cuestiones sobre Node Express</h2>
<ul>
<li>¿Dónde podemos ver qué script se está ejecutando (al realizar 'npm run start')?</li>
</ul>
<p>Al realizar 'npm run start' sobre el directorio raíz de nuestra aplicación estamos 
ejecutando un script que viene especificado en el archivo 'package.json'. Concretamente, 
dentro de este archivo existirá un bloque 'scripts' que indica qué debe ejecutarse al 
realizar el comando 'npm run start'. En este ejemplo:</p>
<p><img alt="package.json script" src="images/script_package.png" /></p>
<ul>
<li>¿Qué comando se está ejecutando?</li>
</ul>
<p>En este caso, el bloque 'scripts' del 'package.json' indica que debe ejecutarse el 
comando 'nodemon src/index.js' cuando tratemos de realizar 'npm run start'.</p>
<h2 id="despliegue-con-netlify">Despliegue con Netlify</h2>
<p>En primer lugar, preparamos una aplicación simple consistente de dos archivos HTML y un
JS e inicializamos el proyecto con:</p>
<pre><code class="language-console">npm init
</code></pre>
<p>Y podemos comprobar en local que funciona correctamente con:</p>
<pre><code class="language-console">node aplicacion.js
</code></pre>
<p>Y accediendo desde el navegador a la IP y puerto de la aplicación (debemos asegurarnos de 
que Tomcat u otras aplicaciones no están utilizando ya ese puerto):</p>
<p><img alt="Comprobación funcionamiento de la aplicación" src="images/comp_inicial.png" /></p>
<p>Alternativamente, también podemos comprobarlo con curl:</p>
<pre><code class="language-console">curl 192.168.0.20:8080
</code></pre>
<p>Para poder desplegar sin problemas la aplicación, debemos modificar el archivo 
'package.json'. En concreto, hay que modificar el bloque 'scripts' dentro de este 
archivo para que quede de la siguiente manera:</p>
<pre><code class="language-console">&quot;scripts&quot;: {
    &quot;start&quot;:&quot;node aplicacion.js&quot;
}
</code></pre>
<p>Teniendo en cuenta todas estas cuestiones, borramos esta aplicación simple y clonamos 
un repositorio de GitHub que contiene una aplicación de ejemplo que sí desplegaremos con 
Netlify.</p>
<p>Utilizaremos dos métodos para desplegar aplicaciones con Netlify: el despliegue manual 
desde el CLI (Command Line Interface) y el despliegue desde el código publicado en 
GitHub.</p>
<p>Antes de empezar con el despliegue, es necesario registrarse en Netlify. En mi caso, me 
registro con mi cuenta de correo, para que no se enlace mi cuenta de GitHub directamente. </p>
<p><img alt="Registro Netlify" src="images/registro_netlify.png" /></p>
<p>Netlify envía un email de confirmación, que nos reenvía a su página donde debemos 
responder a una serie de preguntas sobre nosotros (nombre, si pertenecemos a alguna 
institución o empresa, etc) donde lo único relevante es que he saltado el paso de 
enlace con GitHub, que realizaré más adelante. A continuación, pasamos a los procesos 
del despliegue en sí.</p>
<h3 id="despliegue-mediante-interfaz-de-linea-de-comandos">Despliegue mediante Interfaz de Línea de Comandos</h3>
<p>En primer lugar, será necesario generar un token de acceso personal para que podamos 
establecer una conexión segura con Netlify. Para ello, desde la página web, accedemos 
a las 'users settings' y clicamos en 'Applications'. Desde ahí podremos seleccionar 
'New access token' y se generará un nuevo token, que es una cadena de texto que 
debemos copiar y guardar.</p>
<p>Volviendo al terminal (conectado por SSH a nuestro servidor), debemos definir una 
variable de entorno que contenga el token generado por Netlify:</p>
<pre><code class="language-console">export NETLIFY_AUTH_TOKEN={token_generado_por_netlify}
</code></pre>
<p>Ahora ya podemos instalar el CLI de Netlify: </p>
<pre><code class="language-console">sudo npm install netlify-cli -g
</code></pre>
<p>Y si tratamos de ejecutar 'netlify login', nos dirá que ya estamos loggeados porque ya 
se ha comprobado el contenido de la variable de entorno 'NETLIFY_AUTH_TOKEN'.</p>
<p>Este es el momento de instalar las dependencias de la aplicación, buildearla y 
desplegarla. Nos colocamos dentro del directorio de la aplicación y ejecutamos:</p>
<pre><code class="language-console">sudo npm install
sudo npm run build
netlify deploy
</code></pre>
<p>Le indicamos que queremos crear un nuevo sitio y respondemos las preguntas que nos 
netlify nos plantea. En mi caso: </p>
<p><img alt="Pre-deploy Netlify" src="images/predeploy_netlify.png" /></p>
<p>Esa es la fase de "pre-deploy". Para llevar la aplicación al despliegue definitivo, 
ejecutamos:</p>
<pre><code class="language-console">netlify deploy --prod
</code></pre>
<p>Y le indicamos el directorio con el contenido a desplegar. En mi caso, './build' desde 
el directorio de la aplicación. Para comprobar que el despliegue ha resultado exitoso, 
accedo a la URL que indica Netlify:</p>
<p><img alt="Aplicación desplegada" src="images/despliegue_netlify_cli.png" /></p>
<h3 id="despliegue-mediante-conexion-con-github">Despliegue mediante conexión con GitHub</h3>
<p>Para realizar el despliegue mediante una conexión entre Netlify y GitHub, en primer 
lugar, eliminamos desde la página de Netlify la página desplegada anteriormente 
(accedemos a la configuración del site y bajamos hasta encontrar la opción 'delete site') 
y en nuestra MV, eliminamos el directorio con el contenido de la aplicación.</p>
<p>Para simular un proyecto que hemos desarrollado desde cero y del que, en principio, 
sólo disponemos el código fuente en local, descargaremos el código fuente de la 
misma aplicación que usamos en el despliegue anterior en un archivo zip desde GitHub, 
crearemos un repositorio vacío y subiremos el código fuente de la aplicación. Para ello, 
ejecutamos:</p>
<pre><code class="language-console"># Comandos para bajar el código fuente: 

mkdir practica3-4   # Creamos directorio para almacenar el código.
wget https://github.com/StackAbuse/color-shades-generator/archive/refs/heads/main.zip   # Descargamos el código fuente de la aplicación.
unzip main.zip -d practica3-4   # Descomprimimos el archivo con el código fuente en el directorio creado anteriormente.
cd practica3-4/color-shades-generator-main/ # Nos colocamos en el directorio que contiene el código fuente.
</code></pre>
<p>En este momento es conveniente tener creado el repositorio vacío en GitHub. Para ello, 
accedemos a la página y buscamos el botón de "Nuevo repositorio". En mi caso, mi 
repositorio remoto se llama 'practica3-4'. </p>
<p>Además, es conveniente que creemos un par de claves pública-privada mediante SSH para 
comunicar nuestra MV con GitHub. Para ello:</p>
<pre><code class="language-console">ssh-keygen -t ed25519 -C &quot;a23pebeal@iesgrancapitan.org&quot;
# Donde -t es una bandera que especifíca el algoritmo utilizado para generar las claves.
# Donde -C es un comentario que añadimos a la clave, yo he utilizado el correo electrónico que tengo asociado a mi cuenta de Github, como indica su guía para generar claves SSH.
</code></pre>
<p>A continuación, el comando nos presenta unas preguntas que dejaremos en blanco, de 
manera que las claves se almacenarán en el directorio por defecto '~/.ssh/' y no será 
necesario indicar ninguna frase de seguridad para acceder a las claves. Por último, 
añadimos la clave privada generada al manejador de claves:</p>
<pre><code class="language-console">ssh-add ~/.ssh/id_ed25519
</code></pre>
<p>Momentáneamente dejamos el terminal, accedemos a nuestra cuenta de GitHub desde el 
navegador, nos dirigimos a 'Settings/SSH and GPG keys/' y pulsamos 'Nueva clave SSH'.
Debemos copiar y pegar el contenido de '~/.ssh/id_ed25519.pub' (que es nuestra clave 
pública) y subirlo dos veces, una como 'Authentication key' y otra como 'Signing key'.</p>
<p>Una vez creado el repositorio y configuradas las claves SSH, volvemos al terminal 
(que, recordamos, está conectado por SSH a la MV) y ejecutamos los siguientes comandos 
para inicializar el repositorio local y relacionarlo con el repositorio remoto: </p>
<pre><code class="language-console"># Comandos de git para crear el nuevo repositorio:
git init    # Inicializamos el repositorio
git branch -M main  # Indicamos que la rama principal será &quot;main&quot;
git remote add origin {dirección SSH del repositorio remoto}    # Indicamos la dirección SSH del repositorio remoto al que subiremos el código fuente de la aplicación.

git add .   # Añadimos el código fuente al 'stage' de git.
git commit -m &quot;Subida del código fuente.&quot;   # 'Comprometemos' los archivos en el área de 'stage' y le añadimos un comentario descriptivo.
git push --set-upstream origin main # Subimos el código al repositorio remoto, creando en él la rama 'main', que existe en local pero no aún en remoto. 
</code></pre>
<p>Este es el aspecto que tendrá ahora nuestro repositorio remoto en GitHub:</p>
<p><img alt="Repositorio remoto" src="images/remote_repo.png" /></p>
<p>Con el código subido al repositorio remoto, ya sólo queda enlazar nuestra cuenta de 
GitHub con Netlify. Para ello, volvemos al navegador y entramos a Netlify y seleccionamos 
"Import from Git" e indicamos GitHub como nuestro proveedor. Nos saltará una ventana 
emergente de GitHub preguntándonos si queremos ceder a Netlify permisos para consultar 
información de nuestra cuenta y realizar determinadas acciones: </p>
<p><img alt="Autorización de GitHub a Netlify" src="images/popup_auth_netlify.png" /></p>
<p>Confirmamos la autorización y se nos llevará a otra página (en la misma ventana) 
preguntándonos esta vez dónde queremos "instalar Netlify". Se nos presentará una lista 
de las organizaciones que tenemos asociadas en GitHub, encabezada por nuestro usuario:</p>
<p><img alt="Instalar Netlify" src="images/instalar_netlify.png" /></p>
<p>Seleccionamos nuestro usuario y se nos presentará la opción de instalar Netlify en todos 
nuestros repositorios o en sólo una selección de estos. En este caso, indicaremos sólo 
el repositorio 'practica3-4' y procedemos a la instalación de Netlify:</p>
<p><img alt="Selección repositorio" src="images/seleccion_repositorio.png" /></p>
<p>Ahora se cerrará la ventana emergente y volvemos a la ventana original de Netlify en 
la que estábamos originalmente realizando el enlace a GitHub. Podemos ver que ahora 
nos aparece el repositorio que hemos seleccionado para que se instale Netlify:</p>
<p><img alt="Selección repositorio en Netlify" src="images/sel_repo_netlify.png" /></p>
<p>Lo seleccionamos y llegaremos a la página de deploy, que nos ofrece una serie de 
opciones para el despliegue. En principio, sólo es necesario indicar el nombre del 
'site' (es conveniente comprobar la disponibilidad antes de intentar desplegarlo) 
y podemos dejar el resto de opciones que aparecen predeterminadas:</p>
<p><img alt="Deploy desde la página de Netlify" src="images/deploy_netlify.png" /></p>
<p>Netlify tardará un poco en realizar el despliegue. Cuando haya terminado, saltará un 
mensaje de la página notificándonos que ha finalizado y podremos acceder a la 
aplicación desplegada:</p>
<p><img alt="Aplicación desplegada en Netlify" src="images/aplicacion_desplegada_netlify.png" /></p>
<p>Ahora, todos los cambios que realicemos sobre el código y que subamos a GitHub, se 
realizarán también sobre la aplicación desplegada en Netlify. Para comprobarlo, 
vamos a modificar el archivo ubicado en '/ruta_aplicacion/public/robots.txt'. 
Primero, comprobamos su contenido directamente desde el navegador: </p>
<p><img alt="Contenido inicial robots.txt" src="images/contenido_inicial_robots.png" /></p>
<p>Modifico el contenido en local:</p>
<p><img alt="Modificación local" src="images/mod_local_robots.png" /></p>
<p>Y ejecuto los siguientes comandos de git para subir los cambios a GitHub:</p>
<pre><code class="language-console">git add .
git commit -m &quot;Modificación robótica&quot;
git push
</code></pre>
<p>Si recargamos el navegador, podremos ver el recurso con el contenido actualizado: </p>
<p><img alt="Contenido automáticamente actualizado" src="images/contenido_robots_actualizado.png" /></p>
<p>Es decir que al desplegar la aplicación mediante la vinculación de GitHub con una </p>
<h2 id="despliegue-con-vercel">Despliegue con Vercel</h2>
<p>Para realizar el despliegue con Vercel, creamos una cuenta también con nuestro correo 
electrónico (realizaremos el "enlace con GitHub más adelante). Una vez en la página 
principal de Vercel, se nos presentan varias opciones de proveedores git y escogemos 
GitHub. Al igual que con Netlify, se nos abre una nueva ventana de GitHub que nos pide 
autorizar a Vercel a consultar datos y a realizar acciones sobre GitHub en nombre 
nuestro:</p>
<p><img alt="Permisos Vercel" src="images/permisos_vercel.png" /></p>
<p>Se cerrará la ventana y ahora la página de Vercel habrá cambiado, mostrando la opción 
para importar un repositorio de GitHub al que instalar la aplicación de Vercel:</p>
<p><img alt="Página importación de repositorio" src="images/pag_importacion_vercel.png" /></p>
<p>Clicamos en "Install" y se volverá a abrir otra ventana de GitHub, donde tendremos un 
menú con la lista de nuestras organizaciones, encabezada por nuestro usuario de GitHub, 
idéntica a la que se mostraba en Netlify:</p>
<p><img alt="Instalación Vercel" src="images/install_vercel.png" /></p>
<p>Selecciono mi usuario y de nuevo, podemos instalar la aplicación de Vercel en todos los 
repositorios o sólo en uno. Seleccionamos el repositorio 'practica3-4':</p>
<p><img alt="Selección repositorio Vercel" src="images/sel_repo_vercel.png" /></p>
<p>Se cierra la ventana y ahora en Vercel nos aparecerá el repositorio para importarlo:</p>
<p><img alt="Repositorio listo para importar en Vercel" src="images/repo_en_vercel.png" /></p>
<p>Clicamos en "Import" y se nos dirige a la página de despliegue:</p>
<p><img alt="Página de despliegue en Vercel" src="images/pag_deploy_vercel.png" /></p>
<p>Vercel tardará unos momentos en realizar el despliegue y cuando termine nos lo 
notificará con un mensaje de celebración: </p>
<p><img alt="Despliegue terminado en Vercel" src="images/deploy_terminado_vercel.png" /></p>
<p>Y podremos acceder a la aplicación desplegada:</p>
<p><img alt="App desplegada Vercel" src="images/app_desplegada_vercel.png" /></p>
<p>Volvemos a modificar localmente el archivo '/public/robots.txt':</p>
<p><img alt="Modificación robótica 2" src="images/mod_robots_2.png" /></p>
<p>Subimos los cambios al repositorio remoto y recargamos la aplicación desplegada en 
Vercel:</p>
<p><img alt="Modificación automáticamente desplegada en Vercel" src="images/mod_automatica_vercel.png" /></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = ".",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="js/base.js"></script>
        <script src="search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>

<!--
MkDocs version : 1.6.1
Build Date UTC : 2024-11-20 11:07:20.604077+00:00
-->
